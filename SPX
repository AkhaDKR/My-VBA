Sub data_download()
application.screenupdating=false
application.calculation=xlCalculationManual

'Dim wb as workbook
    Dim myURL As String
    Dim myTO As String
    Dim lr As Long
    Dim user_Name as String
'Dim downldFldr as string
    Dim download_DONE As Boolean
    Dim files_Count As Long
    Dim arr()
    Dim arr_FileName()
'    Dim FSO As Object
'    Set FSO = CreateObject("Scripting.FileSystemObject")
    Dim FSO As New FileSystemObject
    Dim my_File As Scripting.file
'myDict as object
'set myDict=CreateObject("Scripting.Dictionary")
'Dim masterFldr as Scripting.Folder
'Dim subFldr as Scripting.Folder
'Set masterFldr=FSO.getfolder("C:\Users")
'for each subFldr in masterFldr.subfolder
'   if left(subFldr.name,3)="SPX" then
'      user_Name=subFldr.name
'      exit for
'   end if
'next subFldr
'if user_Name="" then
'   exit sub
'end if
'downldFldr="C:\Users\" & user_Name & "\Downloads"
'On Error Resume Next
'Kill downldFldr & "\*.xlsx"
'On Error Goto 0

    Dim msgboxResult As VbMsgBoxResult
    files_Count = 0
    download_DONE = False
    lr = Get_Lr(sTO, 1)
    ReDim arr_FileName(1 To lr, 1 To 1)
    If sTO.Range("A1").Value = "" Or Left(UCase(sTO.Range("A1").Value), 2) <> "TO" Then
        MsgBox "Range A1 must be a TO"
        Exit Sub
    End If
    arr = sTO.Range("A1:D" & lr).Value
    For i = 1 To lr
        myTO = arr(i, 1)
        myURL = "https://spx.shopee.vn/api/in-station/general_to/detail/export?to_number=" & myTO
        Shell ("C:\Program Files (x86)\Google\Chrome\Application\chrome.exe -url " & myURL)
    Next i
    Do
        For Each my_File In FSO.GetFolder(downldFldr).Files
            If Right(my_File.Name, 4) = "xlsx" Then
                files_Count = files_Count + 1
                arr_FileName(files_Count, 1) = my_File.Name
            End If
        Next my_File
        If files_Count = lr Then
            download_DONE = True
        End If
        If Not download_DONE Then
            msgboxResult = MsgBox("Your data is downloading, Please wait!", vbYesNo + vbInformation, "Alert")
            If msgboxResult = vbNo Then
                Exit Sub
            End If
        End If
        
    Loop Until download_DONE
    MsgBox "Download is Done!"

'For i=1 to files_Count
'   set wb=workbooks.open(downldFldr & "\" & arr_Filename(i,1))
'   myTO=wb.sheets(1).range("B1").value
'   For j=1 to lr
'      if myTO=arr(j,1) then
'         arr(j,3)=wb.sheets(1).range("B5").value
'         
'      end if
'   mext j
'next i

Application.Calculation = xlCalculationAutomatic
application.screenupdating=true
End Sub
